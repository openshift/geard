Based off github.com/coreos/go-systemd commit b6bbed6dfecfe5cae49a38330b8ddb730cbd741b
Additional changes made since code was copied
